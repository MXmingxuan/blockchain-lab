{% extends "base.html" %}

{% block title %}é›ªå´©æ•ˆåº”æ¼”ç¤ºå™¨ - åŒºå—é“¾å¯†ç å­¦å·¥å…·{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">ğŸŒ€ é›ªå´©æ•ˆåº”æ¼”ç¤ºå™¨</h1>
    <p class="page-subtitle">è¾“å…¥å¾®å°å˜åŒ–å¯¼è‡´å“ˆå¸Œè¾“å‡ºå·¨å¤§å·®å¼‚ - SHA-256 çš„æ ¸å¿ƒç‰¹æ€§</p>
</div>

<div class="tool-layout">
    <div class="panel">
        <h2 class="panel-title">ğŸ“ è¾“å…¥</h2>

        <div class="input-group">
            <label class="input-label">å­—ç¬¦ä¸² A</label>
            <input type="text" id="stringA" class="input-field" value="Hello World" placeholder="è¾“å…¥ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²">
        </div>

        <div class="input-group">
            <label class="input-label">å­—ç¬¦ä¸² B</label>
            <input type="text" id="stringB" class="input-field" value="Hello world" placeholder="è¾“å…¥ç¬¬äºŒä¸ªå­—ç¬¦ä¸²ï¼ˆå°è¯•åªæ”¹ä¸€ä¸ªå­—ç¬¦ï¼‰">
        </div>

        <button class="btn btn-primary" onclick="compareHashes()">
            ğŸ” å¯¹æ¯”å“ˆå¸Œ
        </button>

        <div class="message info" style="margin-top: 1.5rem;">
            ğŸ’¡ æç¤ºï¼šå°è¯•åªæ”¹å˜ä¸€ä¸ªå­—ç¬¦ï¼ˆå¦‚å¤§å°å†™ï¼‰ï¼Œè§‚å¯Ÿå“ˆå¸Œå€¼çš„å˜åŒ–
        </div>
    </div>

    <div class="panel">
        <h2 class="panel-title">ğŸ“Š åˆ†æç»“æœ</h2>

        <div id="results" style="display: none;">
            <div class="hash-compare">
                <div class="hash-row">
                    <span class="hash-label">å“ˆå¸Œ A:</span>
                    <span class="hash-value" id="hashA"></span>
                </div>
                <div class="hash-row">
                    <span class="hash-label">å“ˆå¸Œ B:</span>
                    <span class="hash-value" id="hashB"></span>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="flippedBits">0</div>
                    <div class="stat-label">ç¿»è½¬ä½æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">256</div>
                    <div class="stat-label">æ€»ä½æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="flipPercent">0%</div>
                    <div class="stat-label">ç¿»è½¬æ¯”ä¾‹</div>
                </div>
            </div>

            <div class="result-box" style="margin-top: 1.5rem;">
                <div class="result-label">ä½å·®å¼‚å¯è§†åŒ–ï¼ˆçº¢è‰²=ä¸åŒï¼‰</div>
                <div class="bit-visual" id="bitVisual"></div>
            </div>
        </div>

        <div id="placeholder" class="message info">
            ğŸ‘† è¾“å…¥ä¸¤ä¸ªå­—ç¬¦ä¸²å¹¶ç‚¹å‡»å¯¹æ¯”æŒ‰é’®æŸ¥çœ‹ç»“æœ
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function compareHashes() {
        const stringA = document.getElementById('stringA').value;
        const stringB = document.getElementById('stringB').value;

        const response = await fetch('/api/avalanche', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ string_a: stringA, string_b: stringB })
        });

        const data = await response.json();

        document.getElementById('hashA').textContent = data.hash_a;
        document.getElementById('hashB').textContent = data.hash_b;
        document.getElementById('flippedBits').textContent = data.flipped_bits;
        document.getElementById('flipPercent').textContent = data.flip_percentage + '%';

        // å¯è§†åŒ–ä½å·®å¼‚
        let bitHtml = '';
        for (let i = 0; i < 256; i++) {
            const bitA = data.binary_a[i];
            const bitB = data.binary_b[i];
            const className = bitA === bitB ? 'bit-same' : 'bit-diff';
            bitHtml += `<span class="${className}">${bitA}</span>`;
            if ((i + 1) % 64 === 0) bitHtml += '<br>';
        }
        document.getElementById('bitVisual').innerHTML = bitHtml;

        document.getElementById('results').style.display = 'block';
        document.getElementById('placeholder').style.display = 'none';
    }
</script>
{% endblock %}