{% extends "base.html" %}

{% block title %}ä¸å¯èƒ½ä¸‰è§’æ¨¡æ‹Ÿå™¨ - åŒºå—é“¾å¯†ç å­¦å·¥å…·{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">ğŸ”º ä¸å¯èƒ½ä¸‰è§’æ¨¡æ‹Ÿå™¨</h1>
    <p class="page-subtitle">æ¢ç´¢å»ä¸­å¿ƒåŒ–ã€å®‰å…¨æ€§å’Œæ‰©å±•æ€§ä¹‹é—´çš„æƒè¡¡ â€” Vitalik çš„åŒºå—é“¾ä¸‰éš¾å›°å¢ƒ</p>
</div>

<div class="tool-layout">
    <!-- å·¦ä¾§ï¼šå‚æ•°è°ƒèŠ‚ -->
    <div class="panel">
        <h3 class="panel-title">âš™ï¸ å‚æ•°è°ƒèŠ‚</h3>

        <div class="input-group">
            <label class="input-label">åŒºå—å¤§å° (KB): <span id="blockSizeValue">1000</span></label>
            <input type="range" id="blockSize" class="input-field" min="100" max="32000" value="1000" step="100"
                oninput="updateValue('blockSize')">
            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted);">
                <span>100 KB</span>
                <span>32 MB</span>
            </div>
        </div>

        <div class="input-group">
            <label class="input-label">å‡ºå—æ—¶é—´ (ç§’): <span id="blockTimeValue">600</span></label>
            <input type="range" id="blockTime" class="input-field" min="1" max="1200" value="600" step="1"
                oninput="updateValue('blockTime')">
            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted);">
                <span>1ç§’</span>
                <span>20åˆ†é’Ÿ</span>
            </div>
        </div>

        <div class="input-group">
            <label class="input-label">å…¨èŠ‚ç‚¹æ•°é‡: <span id="nodeCountValue">10000</span></label>
            <input type="range" id="nodeCount" class="input-field" min="10" max="50000" value="10000" step="10"
                oninput="updateValue('nodeCount')">
            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted);">
                <span>10</span>
                <span>50,000</span>
            </div>
        </div>

        <button class="btn btn-primary" onclick="simulate()" style="width: 100%;">
            ğŸ”„ æ¨¡æ‹Ÿè®¡ç®—
        </button>

        <div id="tradeOffWarning" style="margin-top: 1rem;"></div>
    </div>

    <!-- å³ä¾§ï¼šç»“æœ -->
    <div class="panel">
        <h3 class="panel-title">ğŸ“Š æ¨¡æ‹Ÿç»“æœ</h3>

        <div id="results">
            <div class="message info">è°ƒæ•´å·¦ä¾§å‚æ•°ï¼Œç‚¹å‡»"æ¨¡æ‹Ÿè®¡ç®—"æŸ¥çœ‹ç»“æœ</div>
        </div>

        <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-subtle); border-radius: 8px;">
            <h4 style="margin-bottom: 0.5rem;">ğŸ’¡ ä¸å¯èƒ½ä¸‰è§’</h4>
            <p style="font-size: 0.9rem; color: var(--text-secondary);">
                åŒºå—é“¾å¾ˆéš¾åŒæ—¶å®ç°ï¼š<br>
                <strong>å»ä¸­å¿ƒåŒ–</strong>ï¼šä»»ä½•äººéƒ½èƒ½è¿è¡ŒèŠ‚ç‚¹<br>
                <strong>å®‰å…¨æ€§</strong>ï¼šæŠµæŠ—æ”»å‡»å’Œåˆ†å‰<br>
                <strong>æ‰©å±•æ€§</strong>ï¼šå¤„ç†å¤§é‡äº¤æ˜“
            </p>
        </div>
    </div>
</div>

<script>
    function updateValue(id) {
        const value = document.getElementById(id).value;
        document.getElementById(id + 'Value').textContent = parseInt(value).toLocaleString();
    }

    async function simulate() {
        const blockSize = parseInt(document.getElementById('blockSize').value);
        const blockTime = parseInt(document.getElementById('blockTime').value);
        const nodeCount = parseInt(document.getElementById('nodeCount').value);

        const response = await fetch('/api/trilemma/simulate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                block_size_kb: blockSize,
                block_time_seconds: blockTime,
                node_count: nodeCount
            })
        });

        const result = await response.json();

        // æ˜¾ç¤ºç»“æœ
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
            <div style="text-align: center; padding: 1rem; background: var(--bg-surface); border-radius: 8px; border-left: 4px solid #10b981;">
                <div style="font-size: 0.8rem; color: var(--text-muted);">æ‰©å±•æ€§</div>
                <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;">${result.scalability.tps} TPS</div>
                <div style="font-size: 0.75rem; color: var(--text-muted);">Visa çš„ ${result.scalability.visa_comparison}</div>
            </div>
            <div style="text-align: center; padding: 1rem; background: var(--bg-surface); border-radius: 8px; border-left: 4px solid #3b82f6;">
                <div style="font-size: 0.8rem; color: var(--text-muted);">å»ä¸­å¿ƒåŒ–</div>
                <div style="font-size: 1.5rem; font-weight: bold; color: #3b82f6;">${result.decentralization.score}</div>
                <div style="font-size: 0.75rem; color: var(--text-muted);">${result.decentralization.node_count.toLocaleString()} èŠ‚ç‚¹</div>
            </div>
            <div style="text-align: center; padding: 1rem; background: var(--bg-surface); border-radius: 8px; border-left: 4px solid #ef4444;">
                <div style="font-size: 0.8rem; color: var(--text-muted);">å®‰å…¨æ€§</div>
                <div style="font-size: 1.5rem; font-weight: bold; color: #ef4444;">${result.security.score}</div>
                <div style="font-size: 0.75rem; color: var(--text-muted);">å­¤å—ç‡ ${result.security.orphan_probability}</div>
            </div>
        </div>
        
        <div class="result-box">
            <div class="result-label">æŠ€æœ¯ç»†èŠ‚</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.85rem;">
                <div>æ¯åŒºå—äº¤æ˜“: ${result.scalability.txs_per_block.toLocaleString()}</div>
                <div>å¸¦å®½éœ€æ±‚: ${result.decentralization.bandwidth_required_mbps} Mbps</div>
                <div>å¹´å­˜å‚¨: ${result.decentralization.storage_per_year_gb} GB</div>
                <div>ä¼ æ’­å»¶è¿Ÿ: ${result.security.propagation_time_ms} ms</div>
            </div>
        </div>
    `;

        // æ˜¾ç¤ºè­¦å‘Š
        const warningDiv = document.getElementById('tradeOffWarning');
        const isWarning = result.trade_off_warning.includes('âš ï¸');
        warningDiv.innerHTML = `<div class="message ${isWarning ? 'warning' : 'success'}">${result.trade_off_warning}</div>`;
    }
</script>
{% endblock %}