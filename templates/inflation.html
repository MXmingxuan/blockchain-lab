{% extends "base.html" %}

{% block title %}é€šèƒ€ç‡ä»ªè¡¨ç›˜ - åŒºå—é“¾å¯†ç å­¦å·¥å…·{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">ğŸ“‰ é€šèƒ€ç‡ä»ªè¡¨ç›˜</h1>
    <p class="page-subtitle">æ¯”ç‰¹å¸ä¾›åº”é‡ä¸å‡åŠå€’è®¡æ—¶ - ç¡¬ç¼–ç çš„è´§å¸æ”¿ç­–</p>
</div>

<div class="panel" style="max-width: 1000px; margin: 0 auto;">
    <div style="text-align: center; margin-bottom: 2rem;">
        <button class="btn btn-primary" onclick="loadStats()" style="font-size: 1.1rem; padding: 1rem 2rem;">
            ğŸ”„ è·å–æœ€æ–°æ•°æ®
        </button>
    </div>

    <div id="results" style="display: none;">
        <!-- ä¾›åº”é‡æ¦‚è§ˆ -->
        <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr);">
            <div class="stat-item">
                <div class="stat-value" id="circulating">-</div>
                <div class="stat-label">æµé€šé‡ (BTC)</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="remaining">-</div>
                <div class="stat-label">å‰©ä½™å¾…æŒ–</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="inflation">-</div>
                <div class="stat-label">å¹´åŒ–é€šèƒ€ç‡</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="blockReward">-</div>
                <div class="stat-label">å½“å‰åŒºå—å¥–åŠ±</div>
            </div>
        </div>

        <!-- ä¾›åº”è¿›åº¦æ¡ -->
        <div style="margin-top: 2rem;">
            <h3 class="panel-title">ğŸ“Š ä¾›åº”è¿›åº¦ (æ€»é‡: 21,000,000 BTC)</h3>
            <div style="background: var(--bg-secondary); border-radius: 8px; padding: 1rem;">
                <div style="background: var(--bg-primary); border-radius: 4px; height: 32px; overflow: hidden;">
                    <div id="supplyBar" style="background: var(--gradient-2); height: 100%; transition: width 0.5s;">
                    </div>
                </div>
                <div style="text-align: center; margin-top: 0.5rem;">
                    å·²æŒ–å‡º <span id="supplyPercent" style="color: var(--accent-green); font-weight: bold;">-</span>
                </div>
            </div>
        </div>

        <!-- å‡åŠå€’è®¡æ—¶ -->
        <div
            style="margin-top: 2rem; background: var(--bg-secondary); border-radius: 12px; padding: 1.5rem; text-align: center;">
            <h3 style="color: var(--accent-purple); margin-bottom: 1rem;">â° ä¸‹æ¬¡å‡åŠå€’è®¡æ—¶</h3>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                <div>
                    <div style="font-size: 2.5rem; font-weight: bold; color: var(--accent-blue);" id="blocksRemaining">-
                    </div>
                    <div style="color: var(--text-muted);">å‰©ä½™åŒºå—</div>
                </div>
                <div>
                    <div style="font-size: 2.5rem; font-weight: bold; color: var(--accent-purple);" id="daysRemaining">-
                    </div>
                    <div style="color: var(--text-muted);">é¢„è®¡å¤©æ•°</div>
                </div>
                <div>
                    <div style="font-size: 2.5rem; font-weight: bold; color: var(--accent-green);" id="halvingDate">-
                    </div>
                    <div style="color: var(--text-muted);">é¢„è®¡æ—¥æœŸ</div>
                </div>
            </div>
            <div style="margin-top: 1rem; color: var(--text-secondary);">
                å‡åŠåå¥–åŠ±: <span id="postHalvingReward" style="color: var(--accent-orange);">-</span> BTC/å—
            </div>
        </div>

        <!-- é€šèƒ€å¯¹æ¯” -->
        <div style="margin-top: 2rem;">
            <h3 class="panel-title">ğŸ“ˆ é€šèƒ€ç‡å¯¹æ¯”</h3>
            <div id="inflationComparison" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">
            </div>
        </div>

        <!-- é‡Œç¨‹ç¢‘ -->
        <div style="margin-top: 2rem;">
            <h3 class="panel-title">ğŸ† ä¾›åº”é‡Œç¨‹ç¢‘</h3>
            <div id="milestones" style="display: flex; flex-wrap: wrap; gap: 0.5rem;"></div>
        </div>
    </div>

    <div id="placeholder" class="message info">
        ğŸ‘† ç‚¹å‡»æŒ‰é’®è·å–æœ€æ–°çš„ä¾›åº”é‡æ•°æ®
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function loadStats() {
        const response = await fetch('/api/inflation/stats');
        const data = await response.json();

        document.getElementById('results').style.display = 'block';
        document.getElementById('placeholder').style.display = 'none';

        // åŸºæœ¬æ•°æ®
        document.getElementById('circulating').textContent = (data.supply.circulating / 1e6).toFixed(2) + 'M';
        document.getElementById('remaining').textContent = (data.supply.remaining / 1e6).toFixed(2) + 'M';
        document.getElementById('inflation').textContent = data.inflation.annual_rate + '%';
        document.getElementById('blockReward').textContent = data.reward.current + ' BTC';

        // ä¾›åº”è¿›åº¦
        document.getElementById('supplyBar').style.width = data.supply.progress_percent + '%';
        document.getElementById('supplyPercent').textContent = data.supply.progress_percent + '%';

        // å‡åŠå€’è®¡æ—¶
        document.getElementById('blocksRemaining').textContent = data.halving.blocks_remaining.toLocaleString();
        document.getElementById('daysRemaining').textContent = Math.round(data.halving.days_remaining);
        document.getElementById('halvingDate').textContent = data.halving.estimated_date;
        document.getElementById('postHalvingReward').textContent = data.halving.post_halving_reward;

        // é€šèƒ€å¯¹æ¯”
        let compHtml = '';
        data.inflation.comparison.forEach(item => {
            const color = item.asset === 'æ¯”ç‰¹å¸' ? 'var(--accent-orange)' : 'var(--text-secondary)';
            compHtml += `
            <div class="result-box" style="text-align: center;">
                <div style="font-size: 1.5rem; font-weight: bold; color: ${color};">${item.rate}%</div>
                <div style="color: var(--text-muted); font-size: 0.85rem;">${item.asset}</div>
            </div>`;
        });
        document.getElementById('inflationComparison').innerHTML = compHtml;

        // é‡Œç¨‹ç¢‘
        let mileHtml = '';
        data.milestones.forEach(m => {
            const style = m.reached
                ? 'background: rgba(16, 185, 129, 0.2); border-color: var(--accent-green);'
                : 'background: var(--bg-secondary);';
            mileHtml += `
            <div style="padding: 0.5rem 1rem; border-radius: 8px; border: 1px solid var(--border-color); ${style}">
                ${m.status} ${m.label}
            </div>`;
        });
        document.getElementById('milestones').innerHTML = mileHtml;
    }
</script>
{% endblock %}